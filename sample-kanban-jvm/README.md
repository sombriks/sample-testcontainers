# sample-kanban-jvm

Application showcasing how to configure a postgresql database for testing
purposes using [TestContainers][testcontainers]

## Dependencies

- [java 17][java]
- [docker 25][docker]
- [spring boot 3][spring-boot]
- [thymeleaf 3][thymeleaf]
- [bulma 1][bulma] (via [webjars][webjars])
- [htmx 2][htmx] (via webjars)
- [alpinejs 3][alpinejs] (via webjars)
- and of course [TestContainers 1.19][testcontainers]

## How to build

```bash
./gradlew clean build bootJar
```

## How to run

Be sure to have a postgresql instance running locally. There is a docker compose 
manifest in the [infrastructure folder][infrastructure] to provision one for you
just in case.

```bash
java -jar build/libs/sample-kanban-jvm-0.0.1-SNAPSHOT.jar
```

Or:

```bash
./gradlew bootRun
```

## Noteworthy

- Project is mostly automatically generated by [spring initializr][initializr]
- Unlike node or go versions, due to how classpath works, the init script for
  the database must be in test/resources folder.
- Keep compose database and test container database with similar state can be
  tricky, but the easiest way to do it is to use the same init script.
- Don't forget to [import][spring-config-import] the spring test configuration
  into your test via `@Import` annotation otherwise the test will simply search
  for the database using the regular configuration instead of the TestContainer.
- Mockito still present issues with kotlin. The `mockito-kotlin` dependency is
  there just to solve that.
- The [layout dialect for thymeleaf][layout]
  delivers important feature on view design which, in my opinion, should be part
  of the main thing.
- On the other hand, whenever a development error happens, (i.e. forgot to feed
  proper data in spring mvc model), thymeleaf fails to deliver the correct
  faulty template name, lost itself in the include maze that can form very
  quickly when we go through this pages and components path.
- LiveReload looks like a forgotten art. On eclipse, it just was there, working.
  But with [some research][thm-live-reload] and
  [proper configuration][dev-profile], it can be somewhat restored.
- [Alpine.js][alpinejs] remembers the simplicity of original Angular.js, but
  it's much more like Vue.js. That's a good thing.
- Controller routes for pages and for components are a thing under evaluation.
  It helps even more if the pages are built with components. Proper and wise ids
  attributions are a paramount strategy in this scenario, and i think it helps
  with e2e tests. Still experimenting.

[testcontainers]: https://testcontainers.com/
[java]: https://dev.java/download/
[docker]: https://docs.docker.com/engine/install/
[spring-boot]: https://spring.io/projects/spring-boot
[thymeleaf]: https://www.thymeleaf.org/doc/tutorials/3.1/usingthymeleaf.html
[bulma]: https://bulma.io/documentation/
[webjars]: https://www.webjars.org/
[htmx]: https://htmx.org/docs/#introduction
[infrastructure]: ../infrastructure/docker-compose.yml
[initializr]: <https://start.spring.io/#!type=gradle-project-kotlin&language=kotlin&platformVersion=3.3.0&packaging=jar&jvmVersion=17&groupId=sample.testcontainer&artifactId=kanban&name=sample-kanban-jvm&description=Demo%20project%20for%20Spring%20Boot%2C%20Kotlin%20and%20TestContainers&packageName=sample.testcontainer.kanban&dependencies=web,testcontainers,postgresql,thymeleaf,data-jpa>
[spring-config-import]: ./src/test/kotlin/sample/testcontainer/kanban/services/BoardServiceTestWithTestContainers.kt
[layout]: https://ultraq.github.io/thymeleaf-layout-dialect/getting-started/
[thm-live-reload]: https://attacomsian.com/blog/spring-boot-auto-reload-thymeleaf-templates
[dev-profile]: ./src/main/resources/application-dev.properties
[alpinejs]: https://alpinejs.dev
