# sample-kanban-jvm

Application showcasing how to configure a postgresql database for testing
purposes using [TestContainers][testcontainers]

## Dependencies

- java 17
- docker 25

## How to build

```bash
./gradlew clean build bootJar
```

## How to run

Be sure to have a postgresql instance running locally. There is a docker compose 
manifest in the [infrastructure folder][infrastructure] to provision one for you
just in case.

```bash
java -jar build/libs/sample-kanban-jvm-0.0.1-SNAPSHOT.jar
```

Or:

```bash
./gradlew bootRun
```

## Noteworthy

- Project is mostly automatically generated by [spring initializr][initializr]
- Unlike node or go versions, due to how classpath works, the init script for
  the database must be in test/resources folder.
- Keep compose database and test container database with similar state can be
  tricky, but the easiest way to do it is to use the same init script.
- Don't forget to [import][spring-config-import] the spring test configuration
  into your test via `@Import` annotation otherwise the test will simply search
  for the database using the regular configuration instead of the TestContainer.
- Mockito still present issues with kotlin. The `mockito-kotlin` dependency is
  there just to solve that.

[testcontainers]: https://testcontainers.com/
[infrastructure]: ../infrastructure/docker-compose.yml
[initializr]: <https://start.spring.io/#!type=gradle-project-kotlin&language=kotlin&platformVersion=3.3.0&packaging=jar&jvmVersion=17&groupId=sample.testcontainer&artifactId=kanban&name=sample-kanban-jvm&description=Demo%20project%20for%20Spring%20Boot%2C%20Kotlin%20and%20TestContainers&packageName=sample.testcontainer.kanban&dependencies=web,testcontainers,postgresql,thymeleaf,data-jpa>
[spring-config-import]: ./src/test/kotlin/sample/testcontainer/kanban/services/BoardServiceTestWithTestContainers.kt
